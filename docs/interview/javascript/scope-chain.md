# 作用域链

> 前沿知识：js代码执行前会创建上下文环境，这个上下文环境包含了变量、作用域链和this.

简单理解就是**从当前环境向父级一层一层查找变量的过程称之为作用域链。**

```js
var name = '前端未来';
function hello(){
  console.log(name);
}
```

解释：当我们在函数hello里面打印name的时候，会先在hello作用域中查找，如果没有找到就去hello的父级作用域中查找。



## 深入理解作用域链

首先先介绍一下作用域等一些基础概念。

>  每个JavaScript函数都是一个对象，对象中有些属性我们可以访问，但有些不可以，这些属性仅供JavaScript引擎存取，[[scope]]就是其中一个。
>
> [[scope]] : 指的就是我们所说的作用域，其中存储了执行期上下文的集合
>
> 作用域链 ： [[scope]] 中所存储的执行期上下文对象的集合，这个集合呈链式链接，我们把这种链接叫做作用域链。
>
> 运行期上下文 ： 当函数执行时，会创建一个称为执行期上下文的内部对象（AO）。一个执行期上下文定义了一个函数执行的环境，函数每次执行时对应的执行环境都是独一无二的，所以多次调用一个函数会导致创建多个执行上下文，当函数执行完毕，它所产生的执行上下文被销毁。
>
> 查找变量 ：从作用域链的顶端依次向下查找。

```js
function a(){
    function b(){
        function c(){
 
        }
        c();
    }
    b();
}
a();
 
 
a defined a.[[scope]] ----> 0 : GO          //a定义的时候产生GO对象
a doing   a.[[scope]] ----> 0 : aAO           //a执行的时候新产生AO对象
                            1 : GO
 
b defined  b.[[scope]] ----> 0 : aAO            //子级b定义会继承父级a运行时产生的对象
                             1 : GO 
b doing    b.[[scope]] ---->  0 : bAO            //子级b新产生AO对象
                              1 : aAO 
                              2 : GO 
                              
c defined  c.[[scope]] ---->  0 : bAO            //c定义时会继承b运行时产生的属性
                              1 : aAO 
                              2 : GO                        
c doing     c.[[scope]] ----> 0 : cAO            //c执行时同时又产生新的AO
                              1 ；bAO 
                              2 : aAO 
                              3 : GO 
```



Javascript中有一个执行上下文(execution context)的概念，它定义了变量或函数有权访问的其它数据，决定了他们各自的行为。每个执行环境都有一个与之关联的变量对象，环境中定义的所有变量和函数都保存在这个对象中。

详情查看 [【进阶1-2期】JavaScript深入之执行上下文栈和变量对象-muyiy](https://mp.weixin.qq.com/s?__biz=MzA4Nzg0MDM5Nw==&mid=2247484662&idx=1&sn=bf83b91a5d527395b20620d254ded452&source=41)

**作用域链**：当访问一个变量时，解释器会首先在当前作用域查找标示符，如果没有找到，就去父作用域找，直到找到该变量的标示符或者不在父作用域中，这就是作用域链。

作用域链和原型继承查找时的区别：如果去查找一个普通对象的属性，但是在当前对象和其原型中都找不到时，会返回undefined；但查找的属性在作用域链中不存在的话就会抛出**ReferenceError**。

作用域链的顶端是全局对象，在全局环境中定义的变量就会绑定到全局对象中。

## 额外

IIFE(立即执行函数[表达式])

## 参考

- [JS作用域、立即执行函数、闭包](https://blog.csdn.net/qq_41713692/article/details/80105494)

- [高频前端面试题](https://mp.weixin.qq.com/s/vXeACwujNKcLfnkBB9i9Yw)

- [深入浅出图解作用域链和闭包](https://muyiy.cn/blog/2/2.1.html)
